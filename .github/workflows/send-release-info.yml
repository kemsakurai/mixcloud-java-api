on:
  release:
    types:
      - published
jobs:
  debug:
    name: Debug
    runs-on: ubuntu-latest
    steps:
      - name: Dump env
        run: env | sort
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"
  send-release-info:  
    runs-on: ubuntu-latest
    steps:
    - name: Get release info and Post Data
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh api graphql -f id="${{ github.event.release.node_id }}" -f query='
        query ($id: ID!) {
        	node(id: $id) {
          	... on Release {
            	id
              author {
              	login
              }
              description
              isDraft
              isPrerelease
              databaseId
              name
              repository {
                name
              }
              resourcePath
              updatedAt
              publishedAt
            	createdAt
              tag {
                name
              }
              tagCommit {
                additions
                deletions
              }
              tagName
              url
            }
          }
        }' |
        jq -r '.data.node |        
            {
              id: .id,
              user: .author.login,
              description: .description,
              isDraft: .isDraft,
              isPrerelease: .isPrerelease,
              databaseId: .databaseId,
              name: .name,
              repositoryName: .repository.name,
              resourcePath: .resourcePath,
              publishedAt: .publishedAt,
              updatedAt: .updatedAt,
              createdAt: .createdAt,
              additions: .tagCommit.additions,
              deletions: .tagCommit.deletions,
              tagName: .tagName,
              url: .url              
            } |
            @json' |
        curl 'https://httpbin.org/post' -X POST -H 'accept: application/json' -H 'Content-Type: application/json' -d @-
